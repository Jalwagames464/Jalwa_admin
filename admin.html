<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jalwa Master Admin - Pro Control</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #06091b; --card: #10142d; --gold: #ffd700; --green: #2ecc71; --red: #ff4d4d; --cyan: #00ffca; --blue: #3498db; --purple: #9b59b6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding-bottom: 80px; }
        .top-header { padding: 15px; text-align: center; background: var(--card); border-bottom: 2px solid var(--cyan); position: sticky; top:0; z-index: 1000; }
        .section { display: none; padding: 10px; animation: fadeIn 0.2s; }
        .section.active { display: block; }
        .sub-nav { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; margin-bottom: 15px; border-bottom: 1px solid #1f2855; }
        .sub-item { padding: 10px 20px; background: #161d3d; border-radius: 8px; font-size: 13px; white-space: nowrap; cursor: pointer; color: #7e87a8; border: 1px solid transparent; }
        .sub-item.active { background: var(--cyan); color: #000; font-weight: bold; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; margin: 10px 0; border: 1px solid #1f2855; }
        .btn { border: none; padding: 12px; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        input, textarea, select { width: 100%; background: #06091b; color: white; border: 1px solid #1f2855; border-radius: 10px; padding: 12px; box-sizing: border-box; margin-top: 8px; }
        .num-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin: 10px 0; }
        .num-btn { background: #161d3d; border: 1px solid #333; color: white; padding: 10px 5px; border-radius: 6px; text-align: center; cursor: pointer; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; max-width: 480px; left: 50%; transform: translateX(-50%); background: var(--card); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #1f2855; z-index: 2000; }
        .nav-item { text-align: center; color: #7e87a8; flex: 1; font-size: 11px; cursor: pointer; }
        .nav-item.active { color: var(--cyan); }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }
        #toast { visibility: hidden; min-width: 200px; background: var(--cyan); color: #000; text-align: center; border-radius: 50px; padding: 12px; position: fixed; z-index: 3000; left: 50%; bottom: 100px; transform: translateX(-50%); font-weight: bold; }
        #toast.show { visibility: visible; }
        .live-chip { background: #000; color: var(--gold); padding: 2px 4px; border-radius: 4px; font-size: 10px; display: block; margin-top: 4px; }
    </style>
</head>
<body>

<div id="toast">Updated!</div>

<div class="top-header">
    <h2 style="color:var(--cyan); margin:0;">JALWA MASTER ADMIN</h2>
    <p id="pDisplay" style="font-size:12px; color:var(--gold);">PERIOD: SYNCING...</p>
    <button onclick="activateAudioAlerts()" style="background:var(--gold); color:#000; border:none; padding:4px 10px; border-radius:5px; font-weight:bold; margin-top:5px; font-size:10px;">ðŸ”” ENABLE SOUND ALERTS</button>
</div>

<div id="sec-dash" class="section active">
    <div class="card">
        <h3><i class="fas fa-bullhorn"></i> NOTIFICATION & SLIDERS</h3>
        <textarea id="popMsg" placeholder="Notice Message..."></textarea>
        <div style="display:flex; gap:10px;">
            <button class="btn" style="background:var(--green); flex:1;" onclick="updatePopup('on')">ON</button>
            <button class="btn" style="background:var(--red); flex:1;" onclick="updatePopup('off')">OFF</button>
        </div>
        <hr style="border:0.5px solid #1f2855; margin:15px 0;">
        <textarea id="sliderLinks" placeholder="Slider Image Links (comma separated)"></textarea>
        <button class="btn" style="background:var(--blue);" onclick="updateSlider('on')">UPDATE SLIDER</button>
    </div>

    <div class="card">
        <h3><i class="fas fa-university"></i> ADMIN UPI SETTINGS</h3>
        <input type="text" id="adminUPIInput" placeholder="New UPI ID">
        <button class="btn" style="background:var(--cyan); color:#000;" onclick="updateUPI()">SAVE UPI</button>
    </div>

    <div class="card">
        <h3><i class="fas fa-plus"></i> ADD NEW GAME</h3>
        <input type="text" id="newGName" placeholder="Game Name">
        <input type="text" id="newGLink" placeholder="File Link (ludo.html)">
        <input type="text" id="newGImg" placeholder="Icon URL">
        <button class="btn" style="background:var(--blue);" onclick="addNewGame()">PUBLISH GAME</button>
    </div>
</div>

<div id="sec-games" class="section">
    <div class="sub-nav">
        <div class="sub-item active" onclick="switchTab('wingo', this)">WINGO</div>
        <div class="sub-item" onclick="switchTab('aviator', this)">AVIATOR</div>
        <div class="sub-item" onclick="switchTab('mines', this)">MINES</div>
    </div>

    <div id="tab-wingo" class="game-tab">
        <div class="card">
            <b>WINGO LIVE LOAD</b>
            <div style="display:flex; gap:10px; margin:15px 0;">
                <button class="btn" style="background:var(--green); flex:1;" onclick="sendResult('Green')">GREEN<br><span id="loadG" class="live-chip">â‚¹0</span></button>
                <button class="btn" style="background:var(--purple); flex:1;" onclick="sendResult('Violet')">VIOLET<br><span id="loadV" class="live-chip">â‚¹0</span></button>
                <button class="btn" style="background:var(--red); flex:1;" onclick="sendResult('Red')">RED<br><span id="loadR" class="live-chip">â‚¹0</span></button>
            </div>
            <div class="num-grid">
                <div class="num-btn" onclick="sendResult(0)">0 <span id="n0" class="live-chip">â‚¹0</span></div>
                <div class="num-btn" onclick="sendResult(1)">1 <span id="n1" class="live-chip">â‚¹0</span></div>
                <div class="num-btn" onclick="sendResult(2)">2 <span id="n2" class="live-chip">â‚¹0</span></div>
                <div class="num-btn" onclick="sendResult(3)">3 <span id="n3" class="live-chip">â‚¹0</span></div>
                <div class="num-btn" onclick="sendResult(4)">4 <span id="n4" class="live-chip">â‚¹0</span></div>
                <div class="num-btn" onclick="sendResult(5)">5 <span id="n5" class="live-chip">â‚¹0</span></div>
                <div class="num-btn" onclick="sendResult(6)">6 <span id="n6" class="live-chip">â‚¹0</span></div>
                <div class="num-btn" onclick="sendResult(7)">7 <span id="n7" class="live-chip">â‚¹0</span></div>
                <div class="num-btn" onclick="sendResult(8)">8 <span id="n8" class="live-chip">â‚¹0</span></div>
                <div class="num-btn" onclick="sendResult(9)">9 <span id="n9" class="live-chip">â‚¹0</span></div>
            </div>
        </div>
    </div>

    <div id="tab-aviator" class="game-tab" style="display:none;">
        <div class="card" style="border-left: 4px solid var(--red);">
            <b style="color:var(--red);">ðŸš€ AVIATOR PRO CONTROL</b>
            <input type="number" id="nextCrash" placeholder="Next Crash (e.g. 2.50)" step="0.01">
            <button class="btn" style="background:var(--red);" onclick="setCrash()">SET NEXT CRASH</button>
            <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
                <b>QUICK MODES:</b>
                <div style="display:flex; gap:10px; margin-top:5px;">
                    <button class="btn" style="background:#2ecc71; flex:1; font-size:11px;" onclick="setAviMode('low')">LOW (1.5x-5x)</button>
                    <button class="btn" style="background:#e67e22; flex:1; font-size:11px;" onclick="setAviMode('high')">KILL (1.0x-1.2x)</button>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-mines" class="game-tab" style="display:none;">
        <div class="card" style="border-left: 4px solid var(--gold);">
            <b style="color:var(--gold);">ðŸ’£ MINES SMART CONTROL</b>
            <small>Profit Limit (Auto-Bomb):</small>
            <input type="number" id="mineLimit" placeholder="Profit Limit (Default: 350)">
            <small style="display:block; margin-top:15px;">Force Bomb After Diamonds:</small>
            <select id="forceClick" style="border-color:var(--gold);">
                <option value="0">Random (Normal)</option>
                <option value="2">After 2 Clicks</option>
                <option value="3">After 3 Clicks</option>
                <option value="5">After 5 Clicks</option>
            </select>
            <button class="btn" style="background:var(--gold); color:#000;" onclick="setMinesConfig()">SAVE MINES CONFIG</button>
        </div>
    </div>
</div>

<div id="sec-pay" class="section">
    <div style="display:flex; gap:10px; margin-bottom:15px;">
        <button class="btn" style="background:var(--green); flex:1;" onclick="loadRequests('deposits')">DEPOSITS</button>
        <button class="btn" style="background:var(--red); flex:1;" onclick="loadRequests('withdrawals')">WITHDRAWS</button>
    </div>
    <div id="payList"></div>
</div>

<div id="sec-users" class="section">
    <div id="userList"></div>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="showSection('dash', this)"><i class="fas fa-home"></i>DASH</div>
    <div class="nav-item" onclick="showSection('games', this)"><i class="fas fa-gamepad"></i>GAMES</div>
    <div class="nav-item" onclick="showSection('pay', this)"><i class="fas fa-wallet"></i>PAY</div>
    <div class="nav-item" onclick="showSection('users', this)"><i class="fas fa-users"></i>USERS</div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://jalwa-v2-ad222-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const BOT_TOKEN = '8294881648:AAEuLqO5Tls75kAd0Ija-F4z8T63n4ux3P0';
    const CHAT_ID = '7502348232';

    // --- HIGH PRIORITY ALERTS (WHATSAPP STYLE) ---
    const alertSiren = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');

    function activateAudioAlerts() {
        Notification.requestPermission().then(perm => {
            if(perm === "granted") {
                toast("System Activated âœ…");
                alertSiren.play().catch(e => {}); 
            }
        });
    }

    function triggerFullAlert(title, msg) {
        // 1. Browser Native Push (Banner)
        if (Notification.permission === "granted") {
            new Notification(title, { 
                body: msg, 
                icon: 'https://cdn-icons-png.flaticon.com/512/5502/5502160.png',
                vibrate: [300, 100, 300],
                requireInteraction: true // Banner tab tak nahi jayega jab tak aap hatayenge nahi
            });
        }
        // 2. Play Sound (Siren)
        alertSiren.play().catch(e => console.log("Click the Enable Sound button first"));
        // 3. Vibration
        if (navigator.vibrate) navigator.vibrate([500, 200, 500]);
        // 4. Send to Telegram
        fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent("âš ï¸ " + title + "\n" + msg)}&parse_mode=HTML`);
        toast(title);
    }

    // --- MONITORING ---
    db.ref('users').on('child_changed', snap => {
        triggerFullAlert("USER ACTIVITY", `User ${snap.val().phone} is playing!`);
    });

    db.ref('bets').on('child_added', (periodSnap) => {
        periodSnap.ref.on('child_added', (betSnap) => {
            const b = betSnap.val();
            triggerFullAlert("WINGO BET", `Amt: â‚¹${b.amt} | User: ${b.uid}`);
        });
    });

    db.ref('aviator/bets').on('child_added', snap => {
        triggerFullAlert("AVIATOR BET", `â‚¹${snap.val().amount} bet placed!`);
    });

    db.ref('requests/deposits').on('child_added', snap => {
        if(snap.val().status === 'pending') triggerFullAlert("NEW DEPOSIT", `Amount: â‚¹${snap.val().amount}`);
    });

    // --- ALL ORIGINAL FUNCTIONS (NOT CHANGED) ---
    function sendTele(msg) {
        fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(msg)}&parse_mode=HTML`);
    }
    function showSection(id, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('sec-' + id).classList.add('active');
        el.classList.add('active');
    }
    function switchTab(id, el) {
        document.querySelectorAll('.game-tab').forEach(t => t.style.display = 'none');
        document.querySelectorAll('.sub-item').forEach(s => s.classList.remove('active'));
        document.getElementById('tab-' + id).style.display = 'block';
        el.classList.add('active');
    }
    function toast(m) {
        const t = document.getElementById('toast'); t.innerText = m;
        t.className = "show"; setTimeout(() => t.className = "", 2000);
    }
    function updatePopup(s) { db.ref('appControl/popup').set({ status: s, msg: document.getElementById('popMsg').value }); toast("Notice Updated!"); }
    function updateSlider(s) { const links = document.getElementById('sliderLinks').value.split(',').map(l => l.trim()); db.ref('appControl/slider').set({ status: s, images: links }); toast("Slider Updated!"); }
    function updateUPI() { db.ref('appControl/adminUPI').set(document.getElementById('adminUPIInput').value); toast("UPI Saved!"); }
    function addNewGame() { const name = document.getElementById('newGName').value; const link = document.getElementById('newGLink').value; const img = document.getElementById('newGImg').value; db.ref('appControl/games').push({ name, link, img }); toast("Game Added!"); }
    function sendResult(res) { db.ref('gameControl/nextResult').set(res); toast("Result: " + res); sendTele(`ðŸŽ¯ <b>WINGO RESULT SET:</b> ${res}`); }
    function setCrash() { const val = Number(document.getElementById('nextCrash').value); db.ref('aviator/control/nextCrash').set(val); toast("Crash: " + val); sendTele(`ðŸš€ <b>AVIATOR CRASH SET:</b> ${val}x`); }
    function setAviMode(mode) { let val = mode === 'high' ? 1.05 : 3.50; db.ref('aviator/control/nextCrash').set(val); toast("Mode: " + mode.toUpperCase()); sendTele(`ðŸš€ <b>AVIATOR MODE:</b> ${mode.toUpperCase()}`); }
    function setMinesConfig() { const lim = Number(document.getElementById('mineLimit').value); const f = Number(document.getElementById('forceClick').value); db.ref('gameSettings/mines').update({ limit: lim, forceAfter: f }); toast("Mines Saved!"); sendTele(`ðŸ’£ <b>MINES CONFIG:</b>\nLimit: â‚¹${lim}`); }

    function syncLoad(pId) {
        db.ref('bets/' + pId).on('value', snap => {
            let loads = { Green:0, Violet:0, Red:0, 0:0, 1:0, 2:0, 3:0, 4:0, 5:0, 6:0, 7:0, 8:0, 9:0 };
            snap.forEach(c => { const b = c.val(); if(loads.hasOwnProperty(b.sel)) loads[b.sel] += Number(b.amt); });
            document.getElementById('loadG').innerText = 'â‚¹' + loads.Green; document.getElementById('loadV').innerText = 'â‚¹' + loads.Violet; document.getElementById('loadR').innerText = 'â‚¹' + loads.Red;
            for(let i=0; i<=9; i++) { if(document.getElementById('n'+i)) document.getElementById('n'+i).innerText = 'â‚¹' + (loads[i] || 0); }
        });
    }

    function loadRequests(type) {
        db.ref('requests/' + type).on('value', snap => {
            let h = "";
            snap.forEach(c => {
                const r = c.val();
                if(r.status === 'pending') {
                    h += `<div class="card"><p>User: ${r.uid} | Amt: â‚¹${r.amount}</p>
                    <button class="btn" style="background:var(--green)" onclick="approve('${type}', '${c.key}', '${r.uid}', ${r.amount})">APPROVE</button>
                    <button class="btn" style="background:var(--red)" onclick="db.ref('requests/${type}/${c.key}').update({status:'rejected'})">REJECT</button></div>`;
                }
            });
            document.getElementById('payList').innerHTML = h || "<p style='text-align:center'>No Requests</p>";
        });
    }

    async function approve(type, key, uid, amt) {
        if(type === 'deposits') {
            const uRef = db.ref('users/' + uid + '/balance');
            const snap = await uRef.once('value');
            await uRef.set((Number(snap.val()) || 0) + amt);
        }
        await db.ref('requests/' + type + '/' + key).update({ status: 'approved' });
        toast("Approved!");
    }

    db.ref('users').on('value', snap => {
        let h = "";
        snap.forEach(c => {
            const u = c.val();
            h += `<div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                <div><b>${u.phone}</b><br><small>Bal: â‚¹${u.balance || 0}</small></div>
                <button class="btn" style="width:60px; background:var(--red); margin:0;" onclick="if(confirm('Delete?')) db.ref('users/${c.key}').remove()">DEL</button>
            </div>`;
        });
        document.getElementById('userList').innerHTML = h;
    });

    setInterval(() => {
        const now = new Date();
        const pId = now.getFullYear().toString() + (now.getMonth()+1).toString().padStart(2,'0') + now.getDate().toString().padStart(2,'0') + Math.floor(((now.getHours()*3600)+(now.getMinutes()*60)+now.getSeconds())/30);
        if(document.getElementById('pDisplay').innerText !== "PERIOD: " + pId) {
            document.getElementById('pDisplay').innerText = "PERIOD: " + pId;
            syncLoad(pId);
        }
    }, 1000);
</script>
</body>
</html>
